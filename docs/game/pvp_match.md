# 匹配对战

想要开始一局匹配对战游戏，玩家需要先在主页选择“匹配对战”游戏模式，并选择一个难度（见general.md：常见权重设置），然后点击“开始匹配”。

开始匹配后，系统将使用ELO机制为玩家匹配一名旗鼓相当的对手，并开始一局游戏。

每局游戏开始时，两名玩家各具有100点初始血量，并开始第一轮游戏（记游戏轮数为n，第一轮时n=1，每轮结束时n++）。

对于每轮游戏：

1. 每轮游戏开始时，系统将按难度随机选取题库并从中选取一个“题目”（即化学物质）。
2. 每轮游戏中，两名玩家各可以进行无限次猜测。
3. 某名玩家的某一次猜测被回答后，若AI回答为CORRECT或INCORRECT，则暂不展示回答，并视为该玩家“已锁定答案”，且本轮内该玩家无法再次猜测。
4. 一名玩家锁定答案后，另一名玩家需要在限制时间内（.env中的BATTLE_CONFIRM_TIME_LIMIT对应的值，单位为秒）锁定答案，否则视为放弃本轮。
5. 两名玩家均锁定答案或其中一名玩家选择放弃本轮后，系统同时公布两名玩家最终猜测（即“锁定答案”时的猜测）的AI回答（CORRECT或INCORRECT，“放弃本轮”的玩家视为INCORRECT）。
6. 两名玩家最终猜测的AI回答被公布后，其中回答为CORRECT的玩家视为本轮胜利，回答为INCORRECT的玩家视为本轮失败。两名玩家可以同时胜利，也可以同时失败。
7. 伤害计算规则：每轮分出胜利和失败玩家后，若其中一位玩家胜利，记该玩家本轮的猜测次数为q，基础伤害为d（即.env中BATTLE_DAMAGE_BASE对应的值），伤害倍率增长步长为k（即.env中BATTLE_DAMAGE_SCALE_INCREASEMENT对应的值），则对另一名玩家造成 (k*(n-1) + 1)*d/q 点伤害，受到伤害的玩家血量减少对应点数（两名玩家都胜利时，按此规则相互造成伤害）。若其中一位玩家失败，且另一名玩家胜利，则另一名玩家不受到伤害。若两名玩家都失败，设基础惩罚伤害为p（.env中BATTLE_PUNISHMENT_DAMAGE的值），则两名玩家均受到(k*(n-1) + 1)*p点伤害。
8. 伤害结算完毕后，若两名玩家的血量均高于0，则本轮结束，开启下一轮游戏。

伤害结算后，若任意一名玩家的血量低于0，则整局游戏结束，且：

1. 若其中一名玩家的血量不高于0，且另一名玩家的血量高于0，则血量高于0的玩家整局游戏胜利，另一名玩家失败。
2. 若两名玩家的血量均不高于0，则视为平局。
3. 分出胜负或平局之后，根据ELO机制计算等级分。
4. 显示结束页面，呈现两名玩家的ELO等级分变化，并以表格形式呈现这局游戏中每一轮的“题目”（提前随机选取的物质，即“标准答案”），两名玩家的猜测（正确则为绿色，错误则为红色），以及血量变化（增加则表示为绿色“+x”，减少则表示为红色“-x”，其中x为血量变化的绝对值），并在下方显示“返回主页”按钮。